<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>üì≥ Pinger</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .form-section {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .notification-list {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
    }
    .notification-item {
      padding: 15px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .notification-item:last-child {
      border-bottom: none;
    }
    .notification-item.running {
      background: #e8f5e8;
    }
    .notification-item.stopped {
      background: #fff;
    }
    .notification-details {
      flex-grow: 1;
    }
    .notification-title {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .notification-meta {
      font-size: 0.9em;
      color: #666;
    }
    .notification-controls {
      display: flex;
      gap: 10px;
    }
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .btn-start {
      background: #4caf50;
      color: white;
    }
    .btn-stop {
      background: #f44336;
      color: white;
    }
    .btn-delete {
      background: #ff9800;
      color: white;
    }
    .btn-add {
      background: #2196f3;
      color: white;
      padding: 10px 20px;
      font-size: 1em;
    }
    .form-row {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"], input[type="number"] {
      width: 100%;
      max-width: 300px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: bold;
    }
    .status-running {
      background: #4caf50;
      color: white;
    }
    .status-stopped {
      background: #757575;
      color: white;
    }
  </style>
</head>
<body>
  <h2>üì≥ Pinger</h2>
  <h4>Set multiple reminders for stuff</h4>

  <div class="form-section">
    <h3>Add New Notification</h3>

    <div class="form-row">
      <label>
        Title:
        <input id="title" type="text" value="‚è∞ Reminder!">
      </label>
    </div>

    <div class="form-row">
      <label>
        Body:
        <input id="body" type="text" placeholder="Enter reminder text">
      </label>
    </div>

    <div class="form-row">
      <label>
        Interval (minutes):
        <input id="mins" type="number" min="1" value="15">
      </label>
    </div>

    <div class="form-row">
      <label>
        <input id="stay" type="checkbox"> Keep notification until dismissed
      </label>
    </div>

    <button id="addNotification" class="btn btn-add">Add Notification</button>
  </div>

  <div class="form-section">
    <h3>Active Notifications</h3>
    <div id="notificationList" class="notification-list">
      <div style="padding: 20px; text-align: center; color: #999;">
        No notifications added yet. Add one above to get started!
      </div>
    </div>
  </div>

  <div id="status" style="margin-top: 20px; padding: 10px; border-radius: 5px; display: none;"></div>

  <script>
    let notifications = [];
    let nextId = 1;

    function showStatus(message, isError = false) {
      const statusDiv = document.getElementById("status");
      statusDiv.textContent = message;
      statusDiv.style.display = "block";
      statusDiv.style.backgroundColor = isError ? "#ffebee" : "#e8f5e8";
      statusDiv.style.color = isError ? "#c62828" : "#2e7d32";
      statusDiv.style.border = `1px solid ${isError ? "#ef5350" : "#4caf50"}`;

      setTimeout(() => {
        statusDiv.style.display = "none";
      }, 5000);
    }

    function saveSettings() {
      const settings = {
        title: document.getElementById("title").value,
        body: document.getElementById("body").value,
        mins: document.getElementById("mins").value,
        stay: document.getElementById("stay").checked,
      };
      const notificationsData = notifications.map(n => ({
        id: n.id,
        title: n.title,
        body: n.body,
        mins: n.mins,
        stay: n.stay,
        running: n.running
      }));

      Object.assign(settings, { notifications: notificationsData, nextId });
      localStorage.setItem("reminderSettings", JSON.stringify(settings));
    }

    function loadSettings() {
      const saved = JSON.parse(localStorage.getItem("reminderSettings") || "{}");

      // Load form defaults
      if (saved.title) document.getElementById("title").value = saved.title;
      if (saved.body) document.getElementById("body").value = saved.body;
      if (saved.mins) document.getElementById("mins").value = saved.mins;
      if (saved.stay) document.getElementById("stay").checked = saved.stay;

      // Load existing notifications
      if (saved.notifications) {
        notifications = saved.notifications.map(n => ({
          ...n,
          interval: null,
          running: false // Reset all to stopped on page load
        }));
        nextId = saved.nextId || (notifications.length + 1);
        renderNotifications();
      }
    }

    function createNotification(title, body, mins, stay) {
      return {
        id: nextId++,
        title,
        body,
        mins,
        stay,
        interval: null,
        running: false
      };
    }

    function addNotification() {
      const title = document.getElementById("title").value || "‚è∞ Reminder!";
      const body = document.getElementById("body").value || "";
      const mins = Math.max(1, Number(document.getElementById("mins").value) || 15);
      const stay = document.getElementById("stay").checked;

      const notification = createNotification(title, body, mins, stay);
      notifications.push(notification);

      saveSettings();
      renderNotifications();
      showStatus(`‚úÖ Notification "${title}" added!`);
    }

    function startNotification(id) {
      const notification = notifications.find(n => n.id === id);
      if (!notification) return;

      if (notification.interval) {
        clearInterval(notification.interval);
      }

      // Show immediate test notification
      new Notification(notification.title, {
        body: notification.body || "Reminder started!",
        requireInteraction: notification.stay
      });

      notification.interval = setInterval(() => {
        new Notification(notification.title, {
          body: notification.body,
          requireInteraction: notification.stay
        });
      }, notification.mins * 60 * 1000);

      notification.running = true;
      saveSettings();
      renderNotifications();
      showStatus(`‚úÖ Started "${notification.title}" - every ${notification.mins} minute(s)`);
    }

    function stopNotification(id) {
      const notification = notifications.find(n => n.id === id);
      if (!notification) return;

      if (notification.interval) {
        clearInterval(notification.interval);
        notification.interval = null;
      }

      notification.running = false;
      saveSettings();
      renderNotifications();
      showStatus(`üõë Stopped "${notification.title}"`);
    }

    function deleteNotification(id) {
      const notification = notifications.find(n => n.id === id);
      if (!notification) return;

      if (notification.interval) {
        clearInterval(notification.interval);
      }

      notifications = notifications.filter(n => n.id !== id);
      saveSettings();
      renderNotifications();
      showStatus(`üóëÔ∏è Deleted "${notification.title}"`);
    }

    function renderNotifications() {
      const listDiv = document.getElementById("notificationList");

      if (notifications.length === 0) {
        listDiv.innerHTML = `
          <div style="padding: 20px; text-align: center; color: #999;">
            No notifications added yet. Add one above to get started!
          </div>
        `;
        return;
      }

      listDiv.innerHTML = notifications.map(n => `
        <div class="notification-item ${n.running ? 'running' : 'stopped'}">
          <div class="notification-details">
            <div class="notification-title">${n.title}</div>
            <div class="notification-meta">
              ${n.body ? `"${n.body}" ‚Ä¢ ` : ''}
              Every ${n.mins} minute(s)${n.stay ? ' ‚Ä¢ Persistent' : ''}
              <span class="status-badge ${n.running ? 'status-running' : 'status-stopped'}">
                ${n.running ? 'RUNNING' : 'STOPPED'}
              </span>
            </div>
          </div>
          <div class="notification-controls">
            <button class="btn btn-start" ${n.running ? 'disabled' : ''}
                    onclick="handleStart(${n.id})">
              Start
            </button>
            <button class="btn btn-stop" ${!n.running ? 'disabled' : ''}
                    onclick="stopNotification(${n.id})">
              Stop
            </button>
            <button class="btn btn-delete" onclick="deleteNotification(${n.id})">
              Delete
            </button>
          </div>
        </div>
      `).join('');
    }

    async function handleStart(id) {
      try {
        const permission = await Notification.requestPermission();

        if (permission === "granted") {
          startNotification(id);
        } else if (permission === "denied") {
          showStatus("‚ùå Notifications are blocked. Please enable them in your browser settings.", true);
        } else {
          showStatus("‚ö†Ô∏è Notification permission is required for reminders to work.", true);
        }
      } catch (error) {
        console.error("Notification error:", error);
        showStatus("‚ùå Error setting up notifications: " + error.message, true);
      }
    }

    // Event handlers
    document.getElementById("addNotification").addEventListener("click", addNotification);

    // Save form settings whenever inputs change
    ["title", "body", "mins", "stay"].forEach(id => {
      document.getElementById(id).addEventListener("input", saveSettings);
      document.getElementById(id).addEventListener("change", saveSettings);
    });

    // Load settings on startup
    window.addEventListener("DOMContentLoaded", loadSettings);

    // Cleanup intervals when page unloads
    window.addEventListener("beforeunload", () => {
      notifications.forEach(n => {
        if (n.interval) clearInterval(n.interval);
      });
    });
  </script>
</body>
</html>
