<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ðŸ“³ Pinger</title>
</head>
<body>
  <h2>ðŸ“³ Pinger</h2>
  <h4>Set a reminder for stuff</h4>

  <label>
    Title:
    <input id="title" type="text" value="â° Reminder!">
  </label>
  <br><br>

  <label>
    Body:
    <input id="body" type="text" placeholder="Enter reminder text">
  </label>
  <br><br>

  <label>
    Interval (minutes):
    <input id="mins" type="number" min="1" value="15">
  </label>
  <br><br>

  <label>
    <input id="stay" type="checkbox"> Keep notification until dismissed
  </label>
  <br><br>

  <button id="start">Start Reminder</button>
  <button id="stop" disabled>Stop Reminder</button>
  
  <div id="status" style="margin-top: 20px; padding: 10px; border-radius: 5px; display: none;"></div>

  <script>
    let reminderInterval = null;

    function showStatus(message, isError = false) {
      const statusDiv = document.getElementById("status");
      statusDiv.textContent = message;
      statusDiv.style.display = "block";
      statusDiv.style.backgroundColor = isError ? "#ffebee" : "#e8f5e8";
      statusDiv.style.color = isError ? "#c62828" : "#2e7d32";
      statusDiv.style.border = `1px solid ${isError ? "#ef5350" : "#4caf50"}`;
      
      // Auto-hide success messages after 5 seconds
      if (!isError) {
        setTimeout(() => {
          statusDiv.style.display = "none";
        }, 5000);
      }
    }

    function saveSettings() {
      const settings = {
        title: document.getElementById("title").value,
        body: document.getElementById("body").value,
        mins: document.getElementById("mins").value,
        stay: document.getElementById("stay").checked,
      };
      localStorage.setItem("reminderSettings", JSON.stringify(settings));
    }

    // Startup
    window.addEventListener("DOMContentLoaded", () => {
      const saved = JSON.parse(localStorage.getItem("reminderSettings") || "{}");
      if (saved.title) document.getElementById("title").value = saved.title;
      if (saved.body) document.getElementById("body").value = saved.body;
      if (saved.mins) document.getElementById("mins").value = saved.mins;
      if (saved.stay) document.getElementById("stay").checked = saved.stay;
    });

    // Event handlers
    document.getElementById("start").addEventListener("click", async () => {
      try {
        const permission = await Notification.requestPermission();
        
        if (permission === "granted") {
          const title = document.getElementById("title").value || "â° Reminder!";
          const body = document.getElementById("body").value || "";
          const mins = Math.max(1, Number(document.getElementById("mins").value) || 15);
          const requireInteraction = document.getElementById("stay").checked;

          saveSettings();

          if (reminderInterval) clearInterval(reminderInterval);

          // Show immediate test notification
          new Notification(title, { 
            body: body || "Reminder set up successfully!", 
            requireInteraction 
          });

          reminderInterval = setInterval(() => {
            new Notification(title, { body, requireInteraction });
          }, mins * 60 * 1000);

          document.getElementById("start").disabled = true;
          document.getElementById("stop").disabled = false;
          
          showStatus(`âœ… Reminder started! Every ${mins} minute(s). Test notification sent.`);
          
        } else if (permission === "denied") {
          showStatus("âŒ Notifications are blocked. Please enable them in your browser settings.", true);
        } else {
          showStatus("âš ï¸ Notification permission is required for reminders to work.", true);
        }
      } catch (error) {
        console.error("Notification error:", error);
        showStatus("âŒ Error setting up notifications: " + error.message, true);
      }
    });

    document.getElementById("stop").addEventListener("click", () => {
      if (reminderInterval) {
        clearInterval(reminderInterval);
        reminderInterval = null;
      }
      document.getElementById("start").disabled = false;
      document.getElementById("stop").disabled = true;
      showStatus("ðŸ›‘ Reminder stopped.");
    });

    // Save whenever inputs change
    ["title", "body", "mins", "stay"].forEach(id => {
      document.getElementById(id).addEventListener("input", saveSettings);
      document.getElementById(id).addEventListener("change", saveSettings);
    });
  </script>
</body>
</html>
